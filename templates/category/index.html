{% extends 'layouts/base.html' %}

{% block title %} Dashboard {% endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

<div class="container mt-5">
  <div class="card shadow">
    <div class="card-header border-0">
      <h3 class="mb-0">Category Management</h3>
    </div>
    <div class="card-body">

      <!-- Create / Update Form -->
      <form id="category-form" method="POST">
        <input type="hidden" name="id" id="category-id"> <!-- Hidden ID náº¿u update -->

        <div class="form-group">
          <label for="category-name">Category Name</label>
          <input placeholder="Category name" type="text" name="name" id="category-name" class="form-control" required>
        </div>

        <div class="form-group">
          <label for="category-type">Category Type</label>
          <select name="type" id="category-type" class="form-control" required>
            <option value="">Select type</option>
            <option value="project">Project</option>
            <option value="blog">Blog</option>
          </select>
        </div>

        <button type="submit" class="btn btn-primary btn_save">Save Category</button>
      </form>

      <!-- Category Table -->
      <div class="table-responsive mt-4">
        <table class="table align-items-center table-flush">
          <thead class="thead-light">
            <tr>
              <th scope="col">#</th>
              <th scope="col">Category Name</th>
              <th scope="col">Slug</th>
              <th scope="col">Type</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody id="category-list">
            {% for c in categories %}
            <tr>
              <td>{{ c.id }}</td>
              <td>{{ c.name }}</td>
              <td>{{ c.slug }}</td>
              <td>{{ 'Project' if c.type == 'project' else 'Blog' }}</td>
              <td>
                <a class="btn btn-sm btn-warning text-white">Edit</a>
                <form action="/category/delete/{{ c.id }}" method="POST" style="display:inline;">
                  <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>

{% endblock content %}

{% block javascripts %}
<script>
  document.querySelectorAll(".btn-warning").forEach(btn => {
    btn.addEventListener("click", function () {
      const row = this.closest("tr");
      const id = row.children[0].innerText;
      const name = row.children[1].innerText;
      const type = row.children[3].innerText === "Project" ? 'project' : 'blog';
      document.getElementById("category-id").value = id;
      document.getElementById("category-name").value = name;
      document.getElementById("category-type").value = type;

      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  });
</script>


{% endblock javascripts %}